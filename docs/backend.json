{
  "entities": {
    "Product": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Product",
      "type": "object",
      "description": "Represents a product available for sale.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the product."
        },
        "name": {
          "type": "string",
          "description": "Name of the product."
        },
        "description": {
          "type": "string",
          "description": "Detailed description of the product."
        },
        "imageUrl": {
          "type": "string",
          "description": "URL of the product image.",
          "format": "uri"
        },
        "price": {
          "type": "number",
          "description": "Price of the product."
        },
        "discountPrice": {
          "type": "number",
          "description": "Discounted price of the product, if applicable."
        },
        "inventory": {
          "type": "number",
          "description": "Current inventory level of the product."
        },
        "attributes": {
          "type": "string",
          "description": "Attributes of the product."
        },
        "category": {
          "type": "string",
          "description": "Category of the product."
        }
      },
      "required": [
        "id",
        "name",
        "description",
        "imageUrl",
        "price",
        "inventory",
        "category"
      ]
    },
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user of the application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the user."
        },
        "email": {
          "type": "string",
          "description": "Email address of the user.",
          "format": "email"
        },
        "profileImageUrl": {
          "type": "string",
          "description": "URL of the user's profile image.",
          "format": "uri"
        },
        "role": {
          "type": "string",
          "description": "Role of the user (e.g., admin, customer)."
        },
        "createdAt": {
          "type": "string",
          "description": "The date and time the user was created.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "email",
        "role",
        "createdAt"
      ]
    },
    "CartItem": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "CartItem",
      "type": "object",
      "description": "Represents an item in the shopping cart.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the cart item."
        },
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N CartItem)"
        },
        "productId": {
          "type": "string",
          "description": "Reference to Product. (Relationship: Product 1:N CartItem)"
        },
        "quantity": {
          "type": "number",
          "description": "Quantity of the product in the cart."
        }
      },
      "required": [
        "id",
        "userId",
        "productId",
        "quantity"
      ]
    },
    "Order": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Order",
      "type": "object",
      "description": "Represents a customer order.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the order."
        },
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N Order)"
        },
        "orderDate": {
          "type": "string",
          "description": "Date when the order was placed.",
          "format": "date-time"
        },
        "totalAmount": {
          "type": "number",
          "description": "Total amount of the order."
        },
        "status": {
          "type": "string",
          "description": "Status of the order (e.g., pending, shipped, delivered)."
        },
        "shippingAddress": {
          "type": "string",
          "description": "Shipping address for the order."
        },
        "paymentMethod": {
          "type": "string",
          "description": "Payment method used for the order."
        }
      },
      "required": [
        "id",
        "userId",
        "orderDate",
        "totalAmount",
        "status",
        "shippingAddress",
        "paymentMethod"
      ]
    },
    "OrderItem": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "OrderItem",
      "type": "object",
      "description": "Represents an item within an order.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the order item."
        },
        "orderId": {
          "type": "string",
          "description": "Reference to Order. (Relationship: Order 1:N OrderItem)"
        },
        "productId": {
          "type": "string",
          "description": "Reference to Product. (Relationship: Product 1:N OrderItem)"
        },
        "quantity": {
          "type": "number",
          "description": "Quantity of the product in the order item."
        },
        "price": {
          "type": "number",
          "description": "Price of the product at the time of the order."
        }
      },
      "required": [
        "id",
        "orderId",
        "productId",
        "quantity",
        "price"
      ]
    },
    "Page": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Page",
      "type": "object",
      "description": "Represents a page for the informational pages.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the page."
        },
        "title": {
          "type": "string",
          "description": "Title of the page."
        },
        "content": {
          "type": "string",
          "description": "Content of the page."
        },
        "slug": {
          "type": "string",
          "description": "Slug of the page. Used for the page URL."
        }
      },
      "required": [
        "id",
        "title",
        "content",
        "slug"
      ]
    }
  },
  "auth": {
    "providers": [
      "password"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/products/{productId}",
        "definition": {
          "entityName": "Product",
          "schema": {
            "$ref": "#/backend/entities/Product"
          },
          "description": "Stores product information. Accessible globally.",
          "params": [
            {
              "name": "productId",
              "description": "Unique identifier for the product."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Stores user profile information. Accessible only by the user.",
          "params": [
            {
              "name": "userId",
              "description": "Unique identifier for the user.  This matches the Firebase Auth UID."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/cart_items/{cartItemId}",
        "definition": {
          "entityName": "CartItem",
          "schema": {
            "$ref": "#/backend/entities/CartItem"
          },
          "description": "Stores cart items for a user. Accessible only by the user.",
          "params": [
            {
              "name": "userId",
              "description": "Unique identifier for the user."
            },
            {
              "name": "cartItemId",
              "description": "Unique identifier for the cart item."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/orders/{orderId}",
        "definition": {
          "entityName": "Order",
          "schema": {
            "$ref": "#/backend/entities/Order"
          },
          "description": "Stores orders for a user. Accessible only by the user.",
          "params": [
            {
              "name": "userId",
              "description": "Unique identifier for the user."
            },
            {
              "name": "orderId",
              "description": "Unique identifier for the order."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/orders/{orderId}/order_items/{orderItemId}",
        "definition": {
          "entityName": "OrderItem",
          "schema": {
            "$ref": "#/backend/entities/OrderItem"
          },
          "description": "Stores items within an order. Accessible only by the user who owns the order.",
          "params": [
            {
              "name": "userId",
              "description": "Unique identifier for the user."
            },
            {
              "name": "orderId",
              "description": "Unique identifier for the order."
            },
            {
              "name": "orderItemId",
              "description": "Unique identifier for the order item."
            }
          ]
        }
      },
      {
        "path": "/pages/{pageId}",
        "definition": {
          "entityName": "Page",
          "schema": {
            "$ref": "#/backend/entities/Page"
          },
          "description": "Stores informational pages (e.g., About Us, Contact Us). Accessible globally.",
          "params": [
            {
              "name": "pageId",
              "description": "Unique identifier for the page."
            }
          ]
        }
      },
      {
        "path": "/roles_admin/{userId}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Collection to store admin roles. Existence of a document implies admin role.",
          "params": [
            {
              "name": "userId",
              "description": "Unique identifier for the user."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore data structure is designed to support the WishZep application's requirements for product management, user authentication, shopping cart, orders, and informational pages, while adhering to the principles of Authorization Independence, Clarity of Intent, DBAC (Database-Based Access Control), QAPs (Queries are not Filters), and Invariants. The structure prioritizes simplicity and security, enabling robust security rules and easy debugging.\n\n**Authorization Independence:** Authorization context is denormalized to avoid `get()` calls in security rules.  For example, while the User owns the CartItem and Order, the security is enforced via path-based rules. The product data does not require authorization rules, and thus can be global.\n\n**Structural Segregation:** Documents with different access requirements are stored in separate collections. User-specific data (cart items, orders) are stored under the `/users/{userId}` path, ensuring only the user has access. Informational pages are stored globally without user-specific access controls.\n\n**Access Modeling:** Path-based ownership is used for private user data. Cart items and orders are stored as subcollections of the `/users/{userId}` collection. This allows simple security rules based on `request.auth.uid` without requiring complex `get()` calls or custom claims.  Global roles are managed via the existence of documents in dedicated collections (e.g., `/roles_admin/{uid}`).\n\n**QAPs (Rules are not Filters):** The structure supports secure `list` operations.  For example, listing cart items is restricted to the user owning the `/users/{userId}/cart_items` collection. Since the products are global, list operations do not require special filtering.\n\n**Invariants:** The structure supports the integrity of ownership and timestamps. User-owned data is stored under the `/users/{userId}` path, ensuring ownership is maintained. Timestamps can be enforced via security rules to prevent modification.\n\nThis structure is designed to be scalable, secure, and easy to maintain, making it suitable for the WishZep application's needs."
  }
}
